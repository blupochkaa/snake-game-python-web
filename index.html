<script>
    async function main() {
        const loadingElement = document.getElementById('loading');
        
        try {
            // 1. –ó–∞–≥—Ä—É–∑–∫–∞ Pyodide
            loadingElement.textContent = "üöÄ Loading Python runtime...";
            pyodide = await loadPyodide({
                indexURL: "https://cdn.jsdelivr.net/pyodide/v0.25.0/full/"
            });
            
            // 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ micropip
            loadingElement.textContent = "üì¶ Installing micropip...";
            await pyodide.loadPackage("micropip");
            
            // 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º pygame-web –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ pygame
            loadingElement.textContent = "üéÆ Installing pygame-web...";
            await pyodide.runPythonAsync(`
                import micropip
                # –ü—Ä–æ–±—É–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pygame —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
                await micropip.install('pygame==2.1.3')
            `);
            
            // 4. –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—à—É –∏–≥—Ä—É
            loadingElement.textContent = "üêç Loading game code...";
            const response = await fetch('snake_simple.py');
            const gameCode = await response.text();
            
            // 5. –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
            loadingElement.textContent = "üéØ Starting game...";
            await pyodide.runPythonAsync(gameCode);
            
        } catch (error) {
            loadingElement.innerHTML = `
                ‚ùå Error loading PyGame.<br>
                Trying alternative approach...<br>
                ${error.message}
            `;
            console.error("PyGame error:", error);
            
            // –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥
            await loadAlternativeGame();
        }
    }
</script>
