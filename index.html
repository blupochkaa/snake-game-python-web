<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêç Snake Game - Python in Browser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            text-align: center;
        }
        
        header {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-bottom: 20px;
        }
        
        .game-wrapper {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        }
        
        #game-canvas {
            border: 3px solid #00ff88;
            border-radius: 10px;
            background: #111;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            max-width: 100%;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .control-btn {
            padding: 15px;
            font-size: 1.5rem;
            background: #2c5364;
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background: #00ff88;
            transform: scale(1.05);
        }
        
        .control-btn.up { grid-column: 2; grid-row: 1; }
        .control-btn.left { grid-column: 1; grid-row: 2; }
        .control-btn.down { grid-column: 2; grid-row: 2; }
        .control-btn.right { grid-column: 3; grid-row: 2; }
        
        .loading {
            font-size: 1.5rem;
            color: #00ff88;
            margin: 20px 0;
        }
        
        .info-panel {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
        }
        
        .info-panel h3 {
            color: #00ff88;
            margin-bottom: 10px;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-box {
            background: rgba(0, 255, 136, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #00ff88;
        }
        
        footer {
            margin-top: 30px;
            padding: 20px;
            text-align: center;
            opacity: 0.7;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .controls { max-width: 250px; }
            .control-btn { padding: 12px; font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üêç Python Snake Game</h1>
            <p class="subtitle">Pure Python + PyGame running directly in your browser!</p>
        </header>
        
        <div class="game-wrapper">
            <div class="loading" id="loading">
                ‚è≥ Loading Python runtime... This may take a moment.
            </div>
            
            <canvas id="game-canvas" width="600" height="400" style="display: none;"></canvas>
            
            <div class="controls" style="display: none;">
                <button class="control-btn up" onclick="sendKey('UP')">‚Üë</button>
                <button class="control-btn left" onclick="sendKey('LEFT')">‚Üê</button>
                <button class="control-btn down" onclick="sendKey('DOWN')">‚Üì</button>
                <button class="control-btn right" onclick="sendKey('RIGHT')">‚Üí</button>
                <button class="control-btn" onclick="sendKey('R')" style="grid-column: 1 / span 3; margin-top: 10px;">
                    üîÑ Restart (R)
                </button>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat-box">
                <h3>üéØ Score</h3>
                <p id="score">0</p>
            </div>
            <div class="stat-box">
                <h3>üìè Length</h3>
                <p id="length">3</p>
            </div>
            <div class="stat-box">
                <h3>‚ö° Speed</h3>
                <p id="speed">10</p>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>‚ÑπÔ∏è How it works</h3>
            <p>This game runs <strong>real Python code</strong> in your browser using Pyodide (WebAssembly Python). 
               The game logic is written in pure Python with PyGame, compiled to WebAssembly for the web.</p>
            <p><strong>Controls:</strong> Arrow keys or buttons above. <strong>R</strong> to restart.</p>
        </div>
        
        <footer>
            <p>Made with ‚ù§Ô∏è using Python + PyGame + Pyodide | Hosted on GitHub Pages</p>
            <p>Note: Initial load may take 15-30 seconds to download Python runtime</p>
        </footer>
    </div>

    <!-- Pyodide runtime -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    
    <script>
        let pyodide;
        let gameRunning = false;
        let keyQueue = [];
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à –≤ Python
        function sendKey(key) {
            keyQueue.push(key);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowUp': sendKey('UP'); break;
                case 'ArrowDown': sendKey('DOWN'); break;
                case 'ArrowLeft': sendKey('LEFT'); break;
                case 'ArrowRight': sendKey('RIGHT'); break;
                case 'r':
                case 'R': sendKey('R'); break;
                case ' ': sendKey('SPACE'); break;
            }
        });
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        async function main() {
            const loadingElement = document.getElementById('loading');
            const canvas = document.getElementById('game-canvas');
            const controls = document.querySelector('.controls');
            
            try {
                // 1. –ó–∞–≥—Ä—É–∑–∫–∞ Pyodide
                loadingElement.textContent = "üöÄ Loading Python runtime...";
                pyodide = await loadPyodide({
                    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.25.0/full/"
                });
                
                // 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ micropip –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
                loadingElement.textContent = "üì¶ Installing packages...";
                await pyodide.loadPackage("micropip");
                
                // 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PyGame
                loadingElement.textContent = "üéÆ Installing PyGame...";
                await pyodide.runPythonAsync(`
                    import micropip
                    await micropip.install('pygame')
                `);
                
                // 4. –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—à–µ–π –∏–≥—Ä—ã
                loadingElement.textContent = "üêç Loading game code...";
                const response = await fetch('snake.py');
                if (!response.ok) {
                    throw new Error('Failed to load snake.py');
                }
                const gameCode = await response.text();
                
                // 5. –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
                loadingElement.textContent = "üéØ Starting game...";
                
                // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
                await pyodide.runPythonAsync(`
                    import js
                    import pygame
                    import sys
                    import random
                    
                    # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–≤—è–∑–∏ —Å JS
                    js_score = 0
                    js_length = 3
                    js_speed = 10
                    js_game_over = False
                    
                    # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ HTML
                    def update_stats(score, length, speed):
                        js_score = score
                        js_length = length
                        js_speed = speed
                        
                        # –û–±–Ω–æ–≤–ª—è–µ–º —á–µ—Ä–µ–∑ JS
                        js.document.getElementById("score").textContent = str(score)
                        js.document.getElementById("length").textContent = str(length)
                        js.document.getElementById("speed").textContent = str(speed)
                    
                    # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à –∏–∑ JS
                    def get_keys():
                        keys = js.keyQueue.slice()  # –ö–æ–ø–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤
                        js.keyQueue.length = 0      # –û—á–∏—â–∞–µ–º –æ—á–µ—Ä–µ–¥—å
                        return keys
                    
                    # –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –Ω–∞ canvas
                    def draw_to_canvas(surface):
                        canvas = js.document.getElementById("game-canvas")
                        ctx = canvas.getContext('2d')
                        
                        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º PyGame surface –≤ ImageData
                        width = surface.get_width()
                        height = surface.get_height()
                        
                        # –ü–æ–ª—É—á–∞–µ–º –ø–∏–∫—Å–µ–ª–∏
                        pixels = pygame.surfarray.pixels3d(surface)
                        
                        # –°–æ–∑–¥–∞–µ–º ImageData
                        image_data = ctx.createImageData(width, height)
                        
                        # –ö–æ–ø–∏—Ä—É–µ–º –ø–∏–∫—Å–µ–ª–∏
                        for y in range(height):
                            for x in range(width):
                                idx = (y * width + x) * 4
                                image_data.data[idx] = pixels[x, y, 0]     # R
                                image_data.data[idx + 1] = pixels[x, y, 1] # G
                                image_data.data[idx + 2] = pixels[x, y, 2] # B
                                image_data.data[idx + 3] = 255            # A
                        
                        # –†–∏—Å—É–µ–º –Ω–∞ canvas
                        ctx.putImageData(image_data, 0, 0)
                `);
                
                // –ó–∞—Ç–µ–º –∑–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –∏–≥—Ä—ã
                await pyodide.runPythonAsync(gameCode);
                
                // 6. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É
                loadingElement.style.display = 'none';
                canvas.style.display = 'block';
                controls.style.display = 'grid';
                gameRunning = true;
                
                // 7. –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª —á–µ—Ä–µ–∑ requestAnimationFrame
                function gameLoop() {
                    if (gameRunning) {
                        // –í—ã–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª Python
                        pyodide.runPythonAsync(`
                            try:
                                game_loop()
                            except Exception as e:
                                print("Game loop error:", e)
                        `).then(() => {
                            requestAnimationFrame(gameLoop);
                        }).catch(e => {
                            console.error("Python error:", e);
                            gameRunning = false;
                        });
                    }
                }
                
                gameLoop();
                
            } catch (error) {
                loadingElement.innerHTML = `‚ùå Error: ${error.message}<br>
                                           Check browser console for details.`;
                console.error("Initialization error:", error);
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
        window.addEventListener('load', main);
    </script>
</body>
</html>
